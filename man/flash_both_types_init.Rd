% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03_utility.R
\name{flash_both_types_init}
\alias{flash_both_types_init}
\title{Fit Independent and Smooth Factors with Automatic Initialization}
\usage{
flash_both_types_init(
  data,
  S = NULL,
  k_smooth = 5,
  k_ind = 5,
  ebnm_smooth,
  ebnm_indep = NULL,
  var_type = NULL,
  which_first = "ind",
  verbose = 0,
  backfitting_steps = 0,
  convergence_fn = flashier::flash_conv_crit_max_chg,
  convergence_tol = 1e-04,
  smooth_term = "F",
  smooth_fun = NULL
)
}
\arguments{
\item{data}{A matrix of observed data.}

\item{S}{(Optional) A matrix of standard errors corresponding to the data in \code{data}. Defaults to \code{NULL}.}

\item{k_smooth}{An integer specifying the number of smooth factors to fit. Defaults to \code{5}.}

\item{k_ind}{An integer specifying the number of independent factors to fit. Defaults to \code{5}.}

\item{ebnm_smooth}{A list containing functions for empirical Bayes smoothing of factors (\code{[2]}) and loadings (\code{[1]}).}

\item{ebnm_indep}{(Optional) A function for empirical Bayes estimation of independent factors. Defaults to \code{ebnm::ebnm_point_normal}.}

\item{var_type}{(Optional) An integer specifying the variance type. Defaults to \code{NULL}.}

\item{which_first}{A string specifying whether to fit independent factors (\code{"ind"}) or smooth factors (\code{"smooth"}) first. Defaults to \code{"ind"}.}

\item{verbose}{An integer controlling verbosity. Set to \code{0} for no messages, or higher values for more detailed messages. Defaults to \code{0}.}

\item{backfitting_steps}{An integer specifying the number of backfitting iterations. If \code{0}, backfitting is skipped. Defaults to \code{0}.}

\item{convergence_fn}{A function defining the convergence criterion. Defaults to \code{flashier::flash_conv_crit_max_chg}.}

\item{convergence_tol}{A numeric value specifying the convergence tolerance for smooth factor fitting. Defaults to \code{1e-4}.}

\item{smooth_term}{A string indicating whether to estimate smoothness for factors (\code{"F"}) or loadings (\code{"L"}). Defaults to \code{"F"}.}

\item{smooth_fun}{(Optional) A user-defined smoothing function. If \code{NULL}, it is inferred from \code{ebnm_smooth} based on \code{smooth_term}.}
}
\value{
A list containing:
\itemize{
  \item \code{fit}: A `flashier` fit object containing the results of the fitted independent and smooth factors.
  \item \code{metadata}: A list summarizing the fitting process, including:
    \itemize{
      \item \code{k_ind_effective}: Number of independent factors fitted.
      \item \code{k_smooth_effective}: Number of smooth factors fitted.
      \item \code{which_first}: The order of factor fitting (\code{"ind"} or \code{"smooth"}).
      \item \code{backfitting_steps}: Number of backfitting steps performed.
      \item \code{initialization_result}: The result of the initialization step, including smoothness estimates.
    }
}
}
\description{
This function fits both independent and smooth factors to a dataset
using the `flashier` package. The initialization of factors is based on their
correlation, with smoothness estimated using a smoothing function.
}
\details{
The function performs the following steps:
1. Initializes rank by fitting all factors and estimating their smoothness.
2. Orders factors by smoothness (increasing or decreasing) based on \code{which_first}.
3. Fits factors iteratively, starting with the type specified in \code{which_first}.
4. Optionally performs backfitting to refine the final solution.
}
